{
  "hash": "56e7f9a4fa62d7fa290874cfa3ad5431",
  "result": {
    "markdown": "# Korrastus {#sec-korrastus}\n\n<!--\nData preparation\n-->\n\nAndmete edasiseks analüüsimiseks ette valmistamine kipub olema kogu andmeanalüüsi kõige aeganõudvam osa. Andmeanalüütikud ise on hinnanud, et kogu andmeanalüüsi käigus veedavad nad umbes 80% ajast andmeid korrastades [@wickham14tidy; @kelleher18data]. Sekundaarandmed ei ole peaaegu kunagi täpselt selliselt vormistatnud nagu meie poolt valitud protseduur seda eeldab, mistõttu ilma oskuseta andmeid korrastada ei ole nendega enamasti suurt midagi teha.\n\nAlljärgnevalt uurime keskmist brutopalka ja palgalõhet Eestis ning nendega seotud näitajaid.\n\n\n\n\n\n\n\n\n\n## Veeru nimetused\n\nKui oleme andmed töölauale laadinud, siis esmalt on mõistlik saada nendest ülevaade. Selleks kasutame juba tuttavaid funktsioone objekti esimeste ridade (`head()`) ja ülesehituse (`str()`) kuvamiseks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       Näitaja               Tegevusala   Vaatlusperiood\n1 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad   2002 I kvartal\n2 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad  2002 II kvartal\n3 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad 2002 III kvartal\n4 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad  2002 IV kvartal\n5 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad   2003 I kvartal\n6 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad  2003 II kvartal\n  PA001..KESKMINE.BRUTOPALK..TÖÖJÕUKULU..TÖÖTATUD.TUNNID.JA.TÖÖTAJATE.ARV\n1                                                                     366\n2                                                                     406\n3                                                                     374\n4                                                                     416\n5                                                                     405\n6                                                                     442\n```\n:::\n\n```{.r .cell-code}\nstr(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t7680 obs. of  4 variables:\n $ Näitaja                                                                : chr  \"Keskmine brutokuupalk, eurot\" \"Keskmine brutokuupalk, eurot\" \"Keskmine brutokuupalk, eurot\" \"Keskmine brutokuupalk, eurot\" ...\n $ Tegevusala                                                             : chr  \"Kokku – kõik tegevusalad\" \"Kokku – kõik tegevusalad\" \"Kokku – kõik tegevusalad\" \"Kokku – kõik tegevusalad\" ...\n $ Vaatlusperiood                                                         : chr  \"2002 I kvartal\" \"2002 II kvartal\" \"2002 III kvartal\" \"2002 IV kvartal\" ...\n $ PA001..KESKMINE.BRUTOPALK..TÖÖJÕUKULU..TÖÖTATUD.TUNNID.JA.TÖÖTAJATE.ARV: num  366 406 374 416 405 442 411 455 431 474 ...\n```\n:::\n:::\n\n\nNäeme, et neljandal veerul on pikk ja lohisev nimetus. Andmetabel veeru nimetusi saame kuvada funktsiooniga `names()` ja selle funktsiooni nimetust kasutades saame ka neljandale veerule uue nime anda.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Näitaja\"                                                                \n[2] \"Tegevusala\"                                                             \n[3] \"Vaatlusperiood\"                                                         \n[4] \"PA001..KESKMINE.BRUTOPALK..TÖÖJÕUKULU..TÖÖTATUD.TUNNID.JA.TÖÖTAJATE.ARV\"\n```\n:::\n\n```{.r .cell-code}\nnames(palk)[4] <- 'väärtus'\nnames(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Näitaja\"        \"Tegevusala\"     \"Vaatlusperiood\" \"väärtus\"       \n```\n:::\n:::\n\n\n## Tunnuse tüüp\n\nAndmetabeli ülesehituse küsimisel kuvatakse ka iga tunnuse tüüp, millest sagedasemad on arvtunnus (`num`) ja nimitunnus (`chr`). Täpsemalt loe mõõtmise tasemete ja tunnuse tüüpide kohta [peatükist -@sec-tunnused].\n\n\n::: {.cell}\n\n```{.r .cell-code}\nstr(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n'data.frame':\t7680 obs. of  4 variables:\n $ Näitaja       : chr  \"Keskmine brutokuupalk, eurot\" \"Keskmine brutokuupalk, eurot\" \"Keskmine brutokuupalk, eurot\" \"Keskmine brutokuupalk, eurot\" ...\n $ Tegevusala    : chr  \"Kokku – kõik tegevusalad\" \"Kokku – kõik tegevusalad\" \"Kokku – kõik tegevusalad\" \"Kokku – kõik tegevusalad\" ...\n $ Vaatlusperiood: chr  \"2002 I kvartal\" \"2002 II kvartal\" \"2002 III kvartal\" \"2002 IV kvartal\" ...\n $ väärtus       : num  366 406 374 416 405 442 411 455 431 474 ...\n```\n:::\n:::\n\n\n::: {.callout-warning}\nTunnuse tüüp peab olema objektis määratud vastavalt tunnuse mõõtmise tasemele. Arvud peavad olema objektides salvestatud arvtunnusena ning sõnad ja laused nimitunnusena. Vastupidisel juhul käsitlevad funktsioonid tunnuseid valesti ega võimalda rakendada vajalikke tehteid.\n:::\n\nTunnuse tüüp on oluline selleks et funktsioonid oskaksid neid õigesti kasutada. Nt kui arve sisaldav veerg on laaditud mingil põhjusel^[Kui arve sisaldavasse veergu on sattunud mõni sõna, täht, kirjavahemärk vms, siis R loeb selles veerus olevad väärtused enamasti nimitunnusteks.] objekti nimitunnusena, siis ei ole võimalik sellise tunnusega matemaatilisi tehteid teha. Kui aga andmetabelis on mingi vaatluse kood (nt isikukood), mille R keel tuvastab arvtunnusena, siis on mõistlik salvestada see nimitunnusena, et mitte selle alusel kogemata arvutusi teha. Tunnuste tüübi teisendamiseks saab kasutada funktsioone `as.character()` ja `as.numeric()`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kui arvud on salvestatud nimitunnusena, siis ei saa arvutata keskmist.\npalk$väärtus <- as.character(palk$väärtus)\nhead(palk$väärtus) %>% mean\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning in mean.default(.): argument is not numeric or logical: returning NA\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] NA\n```\n:::\n\n```{.r .cell-code}\n# Kui arvtunnus on õigesti sisestatud, siis saab selle alusel ka arvutada.\npalk$väärtus <- as.numeric(palk$väärtus)\nhead(palk$väärtus) %>% mean\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 401.5\n```\n:::\n:::\n\n\n## Kordumatud väärtused\n\nEelnevalt kuvatud andmetabeli puhul huvitab meid ilmselt, mis võimalikud väärtused on veergudes \"Näitaja\", \"Tegevusala\" ja \"Vaatlusperiood\". Kuna tabelis on 7680 rida, siis ei ole otstarbekas kuvada kõiki väärtusi, vaid ainult neid, mis ei kordu. Selleks on käsklus `unique()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(palk$Näitaja)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Keskmine brutokuupalk, eurot\"                          \n[2] \"Keskmine kuutööjõukulu töötaja kohta, eurot\"           \n[3] \"Osalise tööajaga töötajate töötatud tundide osakaal, %\"\n[4] \"Keskmine töötajate arv, taandatud täistööajale\"        \n```\n:::\n\n```{.r .cell-code}\nunique(palk$Tegevusala)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"Kokku – kõik tegevusalad\"                                          \n [2] \"Põllumajandus, metsamajandus ja kalapüük\"                          \n [3] \"Mäetööstus\"                                                        \n [4] \"Töötlev tööstus\"                                                   \n [5] \"Elektrienergia, gaasi, auru ja konditsioneeritud õhuga varustamine\"\n [6] \"Veevarustus; kanalisatsioon; jäätme- ja saastekäitlus\"             \n [7] \"Ehitus\"                                                            \n [8] \"Hulgi- ja jaekaubandus; mootorsõidukite ja mootorrataste remont\"   \n [9] \"Veondus ja laondus\"                                                \n[10] \"Majutus ja toitlustus\"                                             \n[11] \"Info ja side\"                                                      \n[12] \"Finants- ja kindlustustegevus\"                                     \n[13] \"Kinnisvaraalane tegevus\"                                           \n[14] \"Kutse-, teadus- ja tehnikaalane tegevus\"                           \n[15] \"Haldus- ja abitegevused\"                                           \n[16] \"Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus\"      \n[17] \"Haridus\"                                                           \n[18] \"Tervishoid ja sotsiaalhoolekanne\"                                  \n[19] \"Kunst, meelelahutus ja vaba aeg\"                                   \n[20] \"Muud teenindavad tegevused\"                                        \n```\n:::\n\n```{.r .cell-code}\nunique(palk$Vaatlusperiood)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1] \"2002 I kvartal\"   \"2002 II kvartal\"  \"2002 III kvartal\" \"2002 IV kvartal\" \n [5] \"2003 I kvartal\"   \"2003 II kvartal\"  \"2003 III kvartal\" \"2003 IV kvartal\" \n [9] \"2004 I kvartal\"   \"2004 II kvartal\"  \"2004 III kvartal\" \"2004 IV kvartal\" \n[13] \"2005 I kvartal\"   \"2005 II kvartal\"  \"2005 III kvartal\" \"2005 IV kvartal\" \n[17] \"2006 I kvartal\"   \"2006 II kvartal\"  \"2006 III kvartal\" \"2006 IV kvartal\" \n[21] \"2007 I kvartal\"   \"2007 II kvartal\"  \"2007 III kvartal\" \"2007 IV kvartal\" \n[25] \"2008\"             \"2008 I kvartal\"   \"2008 II kvartal\"  \"2008 III kvartal\"\n[29] \"2008 IV kvartal\"  \"2009\"             \"2009 I kvartal\"   \"2009 II kvartal\" \n[33] \"2009 III kvartal\" \"2009 IV kvartal\"  \"2010\"             \"2010 I kvartal\"  \n[37] \"2010 II kvartal\"  \"2010 III kvartal\" \"2010 IV kvartal\"  \"2011\"            \n[41] \"2011 I kvartal\"   \"2011 II kvartal\"  \"2011 III kvartal\" \"2011 IV kvartal\" \n[45] \"2012\"             \"2012 I kvartal\"   \"2012 II kvartal\"  \"2012 III kvartal\"\n[49] \"2012 IV kvartal\"  \"2013\"             \"2013 I kvartal\"   \"2013 II kvartal\" \n[53] \"2013 III kvartal\" \"2013 IV kvartal\"  \"2014\"             \"2014 I kvartal\"  \n[57] \"2014 II kvartal\"  \"2014 III kvartal\" \"2014 IV kvartal\"  \"2015\"            \n[61] \"2015 I kvartal\"   \"2015 II kvartal\"  \"2015 III kvartal\" \"2015 IV kvartal\" \n[65] \"2016\"             \"2016 I kvartal\"   \"2016 II kvartal\"  \"2016 III kvartal\"\n[69] \"2016 IV kvartal\"  \"2017\"             \"2017 I kvartal\"   \"2017 II kvartal\" \n[73] \"2017 III kvartal\" \"2017 IV kvartal\"  \"2018\"             \"2018 I kvartal\"  \n[77] \"2018 II kvartal\"  \"2018 III kvartal\" \"2018 IV kvartal\"  \"2019\"            \n[81] \"2019 I kvartal\"   \"2019 II kvartal\"  \"2019 III kvartal\" \"2019 IV kvartal\" \n[85] \"2020\"             \"2020 I kvartal\"   \"2020 II kvartal\"  \"2020 III kvartal\"\n[89] \"2020 IV kvartal\"  \"2021\"             \"2021 I kvartal\"   \"2021 II kvartal\" \n[93] \"2021 III kvartal\" \"2021 IV kvartal\"  \"2022 I kvartal\"   \"2022 II kvartal\" \n```\n:::\n:::\n\n\nNäeme, et vaatlusperioodi veerus on läbisegi aastad ja kvartalid. Kui teisendame vastava tunnuse arvtunnuseks, siis tähti sisaldavad väärtused muutuvad puuduvateks väärtusteks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalk$Vaatlusperiood <- as.numeric(palk$Vaatlusperiood)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: NAs introduced by coercion\n```\n:::\n\n```{.r .cell-code}\nunique(palk$Vaatlusperiood)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n [1]   NA 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018 2019 2020 2021\n```\n:::\n:::\n\n\n## Puuduvad väärtused\n\nKui andmetes esineb puuduvaid väärtusi, siis on kolm peamist viisi, kuidas nendega tekkivaid probleeme lahendada. \n\n- Enamasti eemaldatakse andmetabelist vaatlused (read), milles esinevad puuduvad väärtused. \n- Kui on teada, et puuduvad väärtused esinevad juhuslikult, siis on lihtne viis on asendada need veeru keskmise väärtusega.\n- Õigem on tuletada puuduvad väärtused aga teiste veergude väärtuste alusel. Tõeste väärtuse prognoosimiseks on palju erievaid võimalusi, sh masinõpe.\n- Kui puuduvaid väärtusi soovitakse analüüsi kaasata või eraldi uurida, siis saab need eraldi väärtusega määratleda. Puuduvate nimitunnuse väärtustele võib anda mingi nimetuse, arvtunnuse korral võib puuduvad väärtused määratleda eraldi veerus loogilise muutujana.\n\nVaatlusperioodi teisendamise tulemusel on nüüd vastavas veerus puuduvad väärtused nendel juhtudel, kus lisaks aastaarvule oli kirjas ka kvartal. Seega saame tabelisse alles jätta vaid aastaid esindavad väärtused kui eemaldame need read, kus vaatlusperiood puudub. Puuduvate väärtuse määratlemiseks saame kasutada funktsiooni `is.na()` ja olemasolevate väärtuse valimiseks peame seega lisaman funktsiooni ette loogikaoperaatori `!`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Algne ridade arv\nnrow(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 7680\n```\n:::\n\n```{.r .cell-code}\n# Sõelume välja väärtused, kus vaatlusperiood ei ole puudu.\npalk <- filter(palk, !is.na(Vaatlusperiood))\n# Ridade arv pärast puuduvate väärtustega ridade eemaldamist\nnrow(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 1120\n```\n:::\n:::\n\n\nTeine võimalus on kasutada funktsiooni `complete.cases()`, mis väljastab andmetabelis puuduvate väärtusteta read määrava tõeväärtuse, võttes puuduvate väärtuse määramisel arvesse kõiki veerge.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Valime read, kus on ainult täielikud vaatlused\npalk <- palk[complete.cases(palk), ]\n# Eemaldame puuduvate väärtustega read\npalk <- na.omit(palk)\n```\n:::\n\n\n<!--\nData preparation\n-->\n\n## Väärtuste asendamine\n\nMõnikord esineb andmetes väärtusi, mis ei ole teoreetiliselt võimalikud. Sellisel juhul on kolm viisi, kuidas sobimatud väärtused kõrvaldada.\n\n- Arvtunnuse korral saab ebasobiva väärtuse asendada vastavalt vähima või suurima teoreetiliselt võimaliku väärtusega.\n- Võimalusel saab eemaldada kogu ebasobivaid väärtuseid sisaldava tunnuse.\n- Ebasobivaid väärtusi saab kohelda nii nagu puuduvaid väärtuseid.\n\nKui oletame, et meie andmetabelis oleval ajavahemikul oli alampalk kõige vähem 278 eurot kuus, siis ei tohiks olla väärtuseid, kus keskmine brutokuupalk on sellest madalam.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Tekitame uue andmetabeli ainult kõikide tegevusalade keskmise kuupalgaga\nbruto <- filter(palk, \n                Näitaja == 'Keskmine brutokuupalk, eurot' &\n                  Tegevusala == 'Kokku – kõik tegevusalad')\n# Määrame väärtuseks 278 juhtudel, kus väärtus on vähem kui 278\nbruto$väärtus[bruto$väärtus < 278] <- 278\n```\n:::\n\n\n<!--\nData preparation\n-->\n\n## Väärtuste teisendamine\n\nVäärtuste teisendamise käigus antakse tunnusele uued väärtused lähtudes algsetest väärtustest. Selleks on mitu põhjust ja viisi.\n\n- Kui tunnusel on palju äärmuslikul suuri või väikseid väärtusi, siis selline tunnus ei sobi paljude parameetriliste meetodite rakendamiseks. Sellisel juhul saab kasutada erinevaid matemaatilisi teisendusi, mis muudab väärtuste jaotuse sümmeetrilisemaks^[Kui tunnusel on palju äärmuslikult suuri jaotusi, siis naturaallogaritm väärtustest annab tulemuseks sümmeetrilise jaotuse.]. \n- Teatud meetodid eeldavad, et andmed on mõõdetud samal skaalal ehk omavad sarnaseid väärtusi. Sellisel juhul saame väärtused standardiseerida<!--, millest on täpsemalt juttu @sec-standardiseerimine-->.\n- Kui tunnusel on rohkem kordumatuid väärtusi kui soovime, siis saame väärtused intervallida.\n\nKui soovime keskmise brutokuupalga esitada 500 euro laiuste intervallidena, siis saame intervallimiseks kasutada funktsiooni `cut()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbruto$intervallid <- cut(bruto$väärtus, \n                         breaks = c(500,1000,1500,Inf), \n                         labels = c(\">500...1000\",\">1000...1500\",\">1500\"))\nbruto %>% select(Vaatlusperiood, väärtus, intervallid)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n   Vaatlusperiood väärtus  intervallid\n1            2008     825  >500...1000\n2            2009     784  >500...1000\n3            2010     792  >500...1000\n4            2011     839  >500...1000\n5            2012     887  >500...1000\n6            2013     949  >500...1000\n7            2014    1005 >1000...1500\n8            2015    1065 >1000...1500\n9            2016    1146 >1000...1500\n10           2017    1221 >1000...1500\n11           2018    1310 >1000...1500\n12           2019    1407 >1000...1500\n13           2020    1448 >1000...1500\n14           2021    1548        >1500\n```\n:::\n:::\n\n\nAndmetabelisse saab lisada tunnuseid või neid muuta muuhulgas ka funktsiooni `mutate()` abil. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mis aastatel oli keskmine brutotöötasu üle keskmise?\nbruto <- mutate(bruto, ülekeskmise = väärtus > mean(väärtus))\nhead(bruto)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       Näitaja               Tegevusala Vaatlusperiood väärtus\n1 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2008     825\n2 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2009     784\n3 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2010     792\n4 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2011     839\n5 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2012     887\n6 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2013     949\n  intervallid ülekeskmise\n1 >500...1000       FALSE\n2 >500...1000       FALSE\n3 >500...1000       FALSE\n4 >500...1000       FALSE\n5 >500...1000       FALSE\n6 >500...1000       FALSE\n```\n:::\n:::\n\n\n<!--\nData preparation\n-->\n\n## Korrasandmed\n\nKorrasandmed (*tidy data* [@wickham14tidy]) on andmetabeli vormistamise viis, mille korral\n\n1. iga tunnus on eraldi veerus, \n2. iga vaatlus on eraldi real, \n3. iga vaatluste aluseks olev üksus on omaette tabelis^[Nt tellimuste tabelis ei peaks olema kõiki tellija tunnuseid, vaid tellimused ja tellijad tuleks hoida eraldi tabeltes ning ainult vajaduse korral need tellija koodi alusel kokku viia.].\n\n<!--\nTidy data\n-->\n\n### Andmetabeli laiendamine\n\nMeie andmed brutotöötasu kohta vastavad tingimusele, et iga vaatlus (mõõtmine) on eraldi real. Kui lähtume aga sellest, et iga näitaja on omaette tunnus, siis peaks iga näitaja väärtused olema eraldi veerus, et meie andmed korrasandmete tingimusele vastaksid.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                       Näitaja               Tegevusala Vaatlusperiood väärtus\n1 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2008     825\n2 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2009     784\n3 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2010     792\n4 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2011     839\n5 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2012     887\n6 Keskmine brutokuupalk, eurot Kokku – kõik tegevusalad           2013     949\n```\n:::\n:::\n\n\nSellist andmetabelit, milles iga rida sisaldab ainult ühte väärtust, võiks nimetada täielikult kitsaks. Selline kitsas andmetabel ei pruugi olla kõige sobivam viis selles olevate andmete analüüsimiseks. Nt on praegu keeruline võrrelda kahe näitaja väärtusi, sest need väärtused on kõik ühes veerus. Kui soovime tõsta iga näitaja eraldi veergu ehk antud juhul andmetabelit laiendada, siis saame selleks kasutada funktsiooni `pivot_wider()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\npalk <- pivot_wider(palk, names_from = 'Näitaja', values_from = 'väärtus')\nhead(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 6\n  Tegevusala               Vaatlusperiood Keskmine bru…¹ Keskm…² Osali…³ Keskm…⁴\n  <chr>                             <dbl>          <dbl>   <dbl>   <dbl>   <dbl>\n1 Kokku – kõik tegevusalad           2008            825    1113     6.4  543432\n2 Kokku – kõik tegevusalad           2009            784    1067     8.2  488166\n3 Kokku – kõik tegevusalad           2010            792    1074     8.1  458523\n4 Kokku – kõik tegevusalad           2011            839    1137     7.3  469123\n5 Kokku – kõik tegevusalad           2012            887    1203     7.2  489054\n6 Kokku – kõik tegevusalad           2013            949    1284     7    487591\n# … with abbreviated variable names ¹​`Keskmine brutokuupalk, eurot`,\n#   ²​`Keskmine kuutööjõukulu töötaja kohta, eurot`,\n#   ³​`Osalise tööajaga töötajate töötatud tundide osakaal, %`,\n#   ⁴​`Keskmine töötajate arv, taandatud täistööajale`\n```\n:::\n\n```{.r .cell-code}\n# Kuna veeru nimed sisaldavad nüüd tühikuid, siis nimetame need ümber.\nnames(palk) <- c('tegevusala', 'aasta', \n                 'kesk.palk', 'kesk.kulu', 'osatööaeg', 'töötajad')\nhead(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 6\n  tegevusala               aasta kesk.palk kesk.kulu osatööaeg töötajad\n  <chr>                    <dbl>     <dbl>     <dbl>     <dbl>    <dbl>\n1 Kokku – kõik tegevusalad  2008       825      1113       6.4   543432\n2 Kokku – kõik tegevusalad  2009       784      1067       8.2   488166\n3 Kokku – kõik tegevusalad  2010       792      1074       8.1   458523\n4 Kokku – kõik tegevusalad  2011       839      1137       7.3   469123\n5 Kokku – kõik tegevusalad  2012       887      1203       7.2   489054\n6 Kokku – kõik tegevusalad  2013       949      1284       7     487591\n```\n:::\n:::\n\n\nSellisel kujul tabeliga on meil võimalik erinevatel küsimustele vastamiseks arvutusi teha. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Mitu eurot kulus keskmiselt tööjõumaksudeks?\npalk$kesk.maksud <- palk$kesk.kulu - palk$kesk.palk\nhead(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  tegevusala               aasta kesk.palk kesk.kulu osatööaeg töötajad kesk.m…¹\n  <chr>                    <dbl>     <dbl>     <dbl>     <dbl>    <dbl>    <dbl>\n1 Kokku – kõik tegevusalad  2008       825      1113       6.4   543432      288\n2 Kokku – kõik tegevusalad  2009       784      1067       8.2   488166      283\n3 Kokku – kõik tegevusalad  2010       792      1074       8.1   458523      282\n4 Kokku – kõik tegevusalad  2011       839      1137       7.3   469123      298\n5 Kokku – kõik tegevusalad  2012       887      1203       7.2   489054      316\n6 Kokku – kõik tegevusalad  2013       949      1284       7     487591      335\n# … with abbreviated variable name ¹​kesk.maksud\n```\n:::\n:::\n\n\n::: {.callout-warning}\nEnamus funktsioone eeldavad, et funktsiooni argumentidena esitab kasutaja tunnuse väärtusi sisaldava veeru. Seetõttu tuleks andmetabel vormistada selliselt, et iga tunnuse väärtused on eraldi veerus.\n:::\n\n### Andmetabeli kitsendamine\n\nSageli on meil aga vastupidine olukord, kus ühe tunnuse väärtused on jagatud mitmesse veergu. See oli kunagi sagedane nt Statistikaameti tabelite korral, milles vaikimisi esitati iga aasta väärtused eraldi veerus. Sellisel kujul andmed sobivad küll aegridade joonistamiseks tabelarvutuse rakendustes, aga mitte R keele funktsioonide kasutamiseks. \n\nAll on esitatud Statistikaameti tabel PA5335 palgalõhe kohta, milles iga aasta väärtused on eraldi veerus. \n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(lõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 13\n  Tegev…¹ Näitaja `2011` `2012` `2013` `2014` `2015` `2016` `2017` `2018` `2019`\n  <chr>   <chr>    <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>  <dbl>\n1 Tegevu… Meestö…    5.7    5.7    6.1    6.4    7      7.6    7.9    7.9    8.6\n2 Tegevu… Naistö…    4.4    4.3    4.6    4.9    5.4    6      6.3    6.5    7.1\n3 Tegevu… Palgal…   22.9   24.6   24.8   23.5   22.2   20.9   20.9   18     17.1\n4 Põllum… Meestö…    4.2    4.2    4.9    5.2    6.3    6.8    6.7    6.5    6.8\n5 Põllum… Naistö…    3.6    3.9    4.3    4.5    5      5.5    5.8    5.3    5.7\n6 Põllum… Palgal…   14.7    7     12.7   14.5   20.1   19.2   13.2   18.5   15.8\n# … with 2 more variables: `2020` <dbl>, `2021` <dbl>, and abbreviated variable\n#   name ¹​Tegevusala..EMTAK.2008.\n```\n:::\n:::\n\n\nKoondamaks kõikide aastate väärtused ühte veergu, tuleks seda andmetabelit kitsendada ehk pikendada. Seda saab teha nt funktsiooniga `pivot_longer()`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Viime kõik aastad ühte veergu\nlõhe <- pivot_longer(lõhe, cols = as.character(2011:2021), \n                     names_to = 'aasta', values_to = 'väärtus')\nhead(lõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 4\n  Tegevusala..EMTAK.2008. Näitaja                                  aasta väärtus\n  <chr>                   <chr>                                    <chr>   <dbl>\n1 Tegevusalad kokku       Meestöötajate keskmine brutotunnipalk, … 2011      5.7\n2 Tegevusalad kokku       Meestöötajate keskmine brutotunnipalk, … 2012      5.7\n3 Tegevusalad kokku       Meestöötajate keskmine brutotunnipalk, … 2013      6.1\n4 Tegevusalad kokku       Meestöötajate keskmine brutotunnipalk, … 2014      6.4\n5 Tegevusalad kokku       Meestöötajate keskmine brutotunnipalk, … 2015      7  \n6 Tegevusalad kokku       Meestöötajate keskmine brutotunnipalk, … 2016      7.6\n```\n:::\n\n```{.r .cell-code}\n# Viime iga näitaja eraldi veergu\nlõhe <- pivot_wider(lõhe, names_from = 'Näitaja', values_from = 'väärtus')\nhead(lõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  Tegevusala..EMTAK.2008. aasta Meestöötajate keskmine brutotu…¹ Naist…² Palga…³\n  <chr>                   <chr>                            <dbl>   <dbl>   <dbl>\n1 Tegevusalad kokku       2011                               5.7     4.4    22.9\n2 Tegevusalad kokku       2012                               5.7     4.3    24.6\n3 Tegevusalad kokku       2013                               6.1     4.6    24.8\n4 Tegevusalad kokku       2014                               6.4     4.9    23.5\n5 Tegevusalad kokku       2015                               7       5.4    22.2\n6 Tegevusalad kokku       2016                               7.6     6      20.9\n# … with abbreviated variable names\n#   ¹​`Meestöötajate keskmine brutotunnipalk, eurot`,\n#   ²​`Naistöötajate keskmine brutotunnipalk, eurot`, ³​`Palgalõhe, %`\n```\n:::\n\n```{.r .cell-code}\n# Parendame veergude nimetusi\nnames(lõhe) <- c('tegevusala', 'aasta', 'mehed.palk', 'naised.palk', 'lõhe.osa')\nhead(lõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  tegevusala        aasta mehed.palk naised.palk lõhe.osa\n  <chr>             <chr>      <dbl>       <dbl>    <dbl>\n1 Tegevusalad kokku 2011         5.7         4.4     22.9\n2 Tegevusalad kokku 2012         5.7         4.3     24.6\n3 Tegevusalad kokku 2013         6.1         4.6     24.8\n4 Tegevusalad kokku 2014         6.4         4.9     23.5\n5 Tegevusalad kokku 2015         7           5.4     22.2\n6 Tegevusalad kokku 2016         7.6         6       20.9\n```\n:::\n:::\n\n\n::: {.callout-warning}\nKorduvate mõõtmiste korral tuleks mõõtmise aeg kajastada eraldi veerus ja mitte jaotada sama tunnuse mõõtmisi erinevate veergude vahel.\n:::\n\n## Agregeerimine\n\nSageli on vaja andmetabelis olevad väärtused edasiseks analüüsiks või kokkuvõtete saamiseks kuidagi koondada. Väärtuste kokku võtmine mingite rühmade kaupa ja mingi tehte alusel on **agregeerimine**. Nii on agregeerimisel vaja määrata\n\n- väärtusi sisaldav kokku võetav tunnus, \n- väärtusi rühmitav tunnus, \n- kokkuvõtte aluseks olev tehe (funktsioon).\n\nAndmetabeli agregeerimiseks on R keeles funktsioon `aggregate()`, mille argumentideks tuleb sisestada need kolm tegurit. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(palk)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 7\n  tegevusala               aasta kesk.palk kesk.kulu osatööaeg töötajad kesk.m…¹\n  <chr>                    <dbl>     <dbl>     <dbl>     <dbl>    <dbl>    <dbl>\n1 Kokku – kõik tegevusalad  2008       825      1113       6.4   543432      288\n2 Kokku – kõik tegevusalad  2009       784      1067       8.2   488166      283\n3 Kokku – kõik tegevusalad  2010       792      1074       8.1   458523      282\n4 Kokku – kõik tegevusalad  2011       839      1137       7.3   469123      298\n5 Kokku – kõik tegevusalad  2012       887      1203       7.2   489054      316\n6 Kokku – kõik tegevusalad  2013       949      1284       7     487591      335\n# … with abbreviated variable name ¹​kesk.maksud\n```\n:::\n\n```{.r .cell-code}\n# Mis oli igal tegevusalal perioodi keskmise brutotöötasu keskmine?\naggregate(kesk.palk ~ tegevusala, palk, mean)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                           tegevusala kesk.palk\n1        Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus 1332.3571\n2                                                              Ehitus 1076.3571\n3  Elektrienergia, gaasi, auru ja konditsioneeritud õhuga varustamine 1535.0714\n4                                       Finants- ja kindlustustegevus 1822.4286\n5                                             Haldus- ja abitegevused  959.2143\n6                                                             Haridus  974.4286\n7     Hulgi- ja jaekaubandus; mootorsõidukite ja mootorrataste remont  988.1429\n8                                                        Info ja side 1820.7143\n9                                             Kinnisvaraalane tegevus  826.7857\n10                                           Kokku – kõik tegevusalad 1087.5714\n11                                    Kunst, meelelahutus ja vaba aeg  864.0000\n12                            Kutse-, teadus- ja tehnikaalane tegevus 1286.5714\n13                                                         Mäetööstus 1330.0000\n14                                              Majutus ja toitlustus  688.2857\n15                                         Muud teenindavad tegevused  710.8571\n16                           Põllumajandus, metsamajandus ja kalapüük  932.2857\n17                                   Tervishoid ja sotsiaalhoolekanne 1132.3571\n18                                                    Töötlev tööstus 1035.2143\n19              Veevarustus; kanalisatsioon; jäätme- ja saastekäitlus 1092.7857\n20                                                 Veondus ja laondus 1065.8571\n```\n:::\n:::\n\n\nTeine võimalus agregeerimiseks on kasutada pakis `tidyverse` sisalduvaid funktsioone `group_by()` esmalt rühmitamiseks ja `summarise()` seejärel kokku võtmiseks.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(lõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  tegevusala        aasta mehed.palk naised.palk lõhe.osa\n  <chr>             <chr>      <dbl>       <dbl>    <dbl>\n1 Tegevusalad kokku 2011         5.7         4.4     22.9\n2 Tegevusalad kokku 2012         5.7         4.3     24.6\n3 Tegevusalad kokku 2013         6.1         4.6     24.8\n4 Tegevusalad kokku 2014         6.4         4.9     23.5\n5 Tegevusalad kokku 2015         7           5.4     22.2\n6 Tegevusalad kokku 2016         7.6         6       20.9\n```\n:::\n\n```{.r .cell-code}\n# Mis oli igal tegevusalal kõige suurem palgalõhe?\nlõhe %>% \n  group_by(tegevusala) %>% # Rühmitame andmetabeli tegevusala alusel\n  summarise(max(lõhe.osa)) # Leiame suurima palgalõhe\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 20 × 2\n   tegevusala                                                         max(lõhe…¹\n   <chr>                                                                   <dbl>\n 1 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus             12.1\n 2 Ehitus                                                                   22  \n 3 Elektrienergia, gaasi, auru ja konditsioneeritud õhuga varustamine       18.4\n 4 Finants- ja kindlustustegevus                                            43.3\n 5 Haldus- ja abitegevused                                                  20.4\n 6 Haridus                                                                  26.4\n 7 Hulgi- ja jaekaubandus; mootorsõidukite ja mootorrataste remont          33.8\n 8 Info ja side                                                             30.1\n 9 Kinnisvaraalane tegevus                                                  27.3\n10 Kunst, meelelahutus ja vaba aeg                                          28.1\n11 Kutse-, teadus- ja tehnikaalane tegevus                                  24.7\n12 Mäetööstus                                                               36.4\n13 Majutus ja toitlustus                                                    20.9\n14 Muud teenindavad tegevused                                               27.4\n15 Põllumajandus, metsamajandus ja kalapüük                                 20.1\n16 Tegevusalad kokku                                                        24.8\n17 Tervishoid ja sotsiaalhoolekanne                                         29.7\n18 Töötlev tööstus                                                          31.5\n19 Veevarustus; kanalisatsioon, jäätme- ja saastekäitlus                    13.6\n20 Veondus ja laondus                                                       10.3\n# … with abbreviated variable name ¹​`max(lõhe.osa)`\n```\n:::\n:::\n\n\nVäga sageli on kasu ka funktsioonist `table()`, mille abil saab väärtuseid loendada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nhead(lõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 6 × 5\n  tegevusala        aasta mehed.palk naised.palk lõhe.osa\n  <chr>             <chr>      <dbl>       <dbl>    <dbl>\n1 Tegevusalad kokku 2011         5.7         4.4     22.9\n2 Tegevusalad kokku 2012         5.7         4.3     24.6\n3 Tegevusalad kokku 2013         6.1         4.6     24.8\n4 Tegevusalad kokku 2014         6.4         4.9     23.5\n5 Tegevusalad kokku 2015         7           5.4     22.2\n6 Tegevusalad kokku 2016         7.6         6       20.9\n```\n:::\n\n```{.r .cell-code}\n# Mitu korda iga tegevusala tabelis esineb?\ntable(lõhe$tegevusala)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n\n      Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus \n                                                                11 \n                                                            Ehitus \n                                                                11 \nElektrienergia, gaasi, auru ja konditsioneeritud õhuga varustamine \n                                                                11 \n                                     Finants- ja kindlustustegevus \n                                                                11 \n                                           Haldus- ja abitegevused \n                                                                11 \n                                                           Haridus \n                                                                11 \n   Hulgi- ja jaekaubandus; mootorsõidukite ja mootorrataste remont \n                                                                11 \n                                                      Info ja side \n                                                                11 \n                                           Kinnisvaraalane tegevus \n                                                                11 \n                                   Kunst, meelelahutus ja vaba aeg \n                                                                11 \n                           Kutse-, teadus- ja tehnikaalane tegevus \n                                                                11 \n                                                        Mäetööstus \n                                                                11 \n                                             Majutus ja toitlustus \n                                                                11 \n                                        Muud teenindavad tegevused \n                                                                11 \n                          Põllumajandus, metsamajandus ja kalapüük \n                                                                11 \n                                                 Tegevusalad kokku \n                                                                11 \n                                  Tervishoid ja sotsiaalhoolekanne \n                                                                11 \n                                                   Töötlev tööstus \n                                                                11 \n             Veevarustus; kanalisatsioon, jäätme- ja saastekäitlus \n                                                                11 \n                                                Veondus ja laondus \n                                                                11 \n```\n:::\n\n```{.r .cell-code}\n# Mitmel aastal oli igal tegevusalal palgalõhe rohkem kui 10%?\ntable(lõhe$tegevusala, lõhe$lõhe.osa > 10)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                                    \n                                                                     FALSE TRUE\n  Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus           8    3\n  Ehitus                                                                 1   10\n  Elektrienergia, gaasi, auru ja konditsioneeritud õhuga varustamine     1   10\n  Finants- ja kindlustustegevus                                          0   11\n  Haldus- ja abitegevused                                                2    9\n  Haridus                                                                0   11\n  Hulgi- ja jaekaubandus; mootorsõidukite ja mootorrataste remont        0   11\n  Info ja side                                                           0   11\n  Kinnisvaraalane tegevus                                                0   11\n  Kunst, meelelahutus ja vaba aeg                                        1   10\n  Kutse-, teadus- ja tehnikaalane tegevus                                2    9\n  Mäetööstus                                                             0   11\n  Majutus ja toitlustus                                                  1   10\n  Muud teenindavad tegevused                                             2    9\n  Põllumajandus, metsamajandus ja kalapüük                               3    8\n  Tegevusalad kokku                                                      0   11\n  Tervishoid ja sotsiaalhoolekanne                                       0   11\n  Töötlev tööstus                                                        0   11\n  Veevarustus; kanalisatsioon, jäätme- ja saastekäitlus                  8    3\n  Veondus ja laondus                                                    10    1\n```\n:::\n:::\n\n\nÜleval olevast tabelist näeme muuhulgas, et \n\n- veonduses ja laonduses oli palgalõhe ainult ühel aastal üle 10%, samas kui \n- hariduses oli kõikidel aastatel palgalõhe üle 10%.\n\n---\n\nTabelarvutuses on andmete koondamiseks kaks võimalust: \n\n- kasutada vastavaid funktsioone ja arvutada koond iga rümitava tunnuse väärtuse kohta eraldi või \n- tekitada andmetabeli alusel liigendtabel (*pivot table*) koos kõikide rühmitava tunnuse väärtuste koonditega.\n\nFunktsioonide abil saame leida ette antud rühma väärtuste summa (`=sum()`), keskmise (`=average()`) või arvu (`=count()`). Selleks peame vastavate funktsioonide nimetuste lõppu lisama ühe rühmitava tunnuse korral `if` ja mitme korral `ifs`. Nt kui soovime leida veeru B ainult nende ridade summa, kus veerus A on väärtus 2020, siis peaksime kasutama funktsiooni kujul nt `=sumif(A:A,2020,B:B)`.\n\nLiigendtabel võimaldab leida korraga ühe tunnuse kõikide rühmade koondi. Selleks peame esmalt määratlema veergude nimetused, määrates neile filtrid. Seejärel saame lisada liigendabeli. Selles tabelis saame esitada kas ridades või veergudes rühmitamise aluseks oleva tunnuse või mitu, tõstes need vastavatesse lahtritesse. Tabelis kuvatakse selle tunnuse koond, mille tõstame väärtuste lahtrisse. Kokkuvõtte aluseks oleva tehte saab määrata samuti selles lahtris.\n\n<!--\nAggregation\n-->\n\n## Tabelite ühendamine\n\nMõnikord on sama vaatluse andmed erinevates tabelites. Sellisel juhul saame kaks tabelit omavahel ühendada ühe või mitme tunnuse väärtuste alusel.\n\nKäesolevates näidetes võiksime ühendada brutopalga ja palgalõhe andmetabelid `palk` ja `lõhe`. Mõlemas tabelis esindab iga rida ühte tegevusala ühel aastal, mistõttu saab nende kahe tunnuse alusel read kokku viia. \n\nSelleks peavad sama tähendusega väärtused olema samamoodi nimetatud. Saame seda kontrollida funktsiooniga `setdiff()`, mis näitab, millised esimeses argumendis olevad kordumatud väärtused on puudu teisest argumendist.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Milliseid palgalõhe tabelis olevaid tegevusalasid ei ole brutopalga tabelis?\nsetdiff(lõhe$tegevusala, palk$tegevusala)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Tegevusalad kokku\"                                    \n[2] \"Veevarustus; kanalisatsioon, jäätme- ja saastekäitlus\"\n```\n:::\n\n```{.r .cell-code}\n# Milliseid brutopalga tabelis olevaid tegevusalasid ei ole palgalõhe tabelis?\nsetdiff(palk$tegevusala, lõhe$tegevusala)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"Kokku – kõik tegevusalad\"                             \n[2] \"Veevarustus; kanalisatsioon; jäätme- ja saastekäitlus\"\n```\n:::\n:::\n\n\nNäeme, et kahes tabelis on samad nähtused kas erinevate nimetustega või siis on semikooloni asemel kastatud koma. Muudame väärtuste nimetused nii, et sama nähtus oleks täpselt samamoodi sõnastatud.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Määrame palgalõhe tabelis tegevusalale semikooloni koma asemele\nlõhe$tegevusala[lõhe$tegevusala == 'Veevarustus; kanalisatsioon, jäätme- ja saastekäitlus'] <- 'Veevarustus; kanalisatsioon; jäätme- ja saastekäitlus'\n# Määrame brutopalga tabelis veerus tegevusala \"Tegevusalad kokku\" seal, \n# kus on pregu on \"Kokku - kõik tegevusalad\"\npalk$tegevusala[palk$tegevusala == 'Kokku – kõik tegevusalad'] <- 'Tegevusalad kokku'\n```\n:::\n\n\nKaks tabelit saame ühendada funktsiooniga `merge()`. \n\n\n::: {.cell}\n\n```{.r .cell-code}\npalkLõhe <- merge(\n  palk, lõhe, \n  by.x = c('tegevusala', 'aasta'), # Brutopalga tabeli ühendatavad tunnused\n  by.y = c('tegevusala', 'aasta'), # Palgalõhe tabeli ühendatavad tunnused\n  all.x = TRUE, # Jätame alles kõik brutopalga tabeli read\n  all.y = TRUE) # Jätame alles kõik palgalõhe tabeli read\n# Meie andmetabelites on ühendatavad tunnused sama nimega, \n# seega võime mõned argumendid ära jätta või neid lihtsustada\npalkLõhe <- merge(palk, lõhe, all = TRUE)\nhead(palkLõhe)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                                                    tegevusala aasta kesk.palk\n1 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus  2008      1061\n2 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus  2009       981\n3 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus  2010       955\n4 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus  2011       988\n5 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus  2012      1037\n6 Avalik haldus ja riigikaitse; kohustuslik sotsiaalkindlustus  2013      1130\n  kesk.kulu osatööaeg töötajad kesk.maksud mehed.palk naised.palk lõhe.osa\n1      1434       2.6    34776         373         NA          NA       NA\n2      1337       3.6    34693         356         NA          NA       NA\n3      1297       3.4    34935         342         NA          NA       NA\n4      1341       3.2    35034         353        6.2         5.5     10.2\n5      1408       2.9    35138         371        5.8         5.3      9.8\n6      1526       2.6    34552         396        6.4         5.7     12.1\n```\n:::\n:::\n\n\nÜhendatud tabeli alusel saame varem kahes eraldi tabelis olnud tunnuseid nüüd omavahel võrrelda. Näiteks saame uurida, kuidas on palgalõhe seotud osatööaja, keskmise palga ja tegevusalaga ning kuidas see seos aastate jooksul muutunud on.\n\n\n::: {.cell .column-page-right}\n\n```{.r .cell-code}\nggplot(palkLõhe) + \n  aes(x = lõhe.osa, y = osatööaeg, size = kesk.palk, color = aasta) + \n  geom_point(alpha = .5) +\n  facet_wrap(~tegevusala, ncol = 3) +\n  theme_minimal()\n```\n\n::: {.cell-output-display}\n![](korrastus_files/figure-html/unnamed-chunk-27-1.png){width=960}\n:::\n:::\n\n\n---\n\nTabelarvutuse rakendustes ei saa ühendada omavahel terveid tabeleid. Küll aga saame ühele tabelile lisada korraga ühe veeru teisest tabelist nii, et väärtuste määramise aluseks on mingi mõlemas tabelis olev tunnus. Saame selleks kasutada funktsiooni `=vlookup()`. \n\n<!--\ncase_when()\nrecode()\n-->",
    "supporting": [
      "korrastus_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}